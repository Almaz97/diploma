{% extends "layout.html" %}
{% load i18n %}
{% block main %}
    <main role="main" class="container">
      <div class="row">
          {% if messages %}
              {% for message in messages %}
                  <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                  </div>
              {% endfor %}
          {% endif %}
          {% block content %}
               <div class="container mb-3 mt-3">
        <h2>Заявки на конкурс: {{ contest.name }}</h2>
            <table class="table table-striped table-bordered" style="width: 100%; border: none;" id="mydatatable">
                <thead>
                    <tr>
                        <th>ФИО</th>
                        <th>Email</th>
                        <th>Номер</th>
                        <th colspan="2">
                          <center>
                          <span>Голоса</span>
                          </center>
                          <div style="display: grid; grid-template-columns: 1fr 1fr;">
                          <span style="border-right: 1px solid; text-align: center;">Против</span>
                          <span style="text-align: center;">За</span>
                          </div>
                        </th>

                    </tr>
                </thead>
                <tbody>
                    {% for application in contest_applications %}
                        <tr id="row_{{ application.id }}">
                            <td class="align-middle" class="full_name">{{ application.contestant.full_name }}</td>
                            <td class="align-middle" class="email_address">{{ application.contestant.email }}</td>
                            <td class="align-middle" class="phone_number">{{ application.contestant.phone_number }}</td>
                            <td class="text-center expand-button accordion-toggle collapsed" id="accordion_{{ application.id }}" data-toggle="collapse" data-parent="#accordion_{{ application.id }}" href="#collapse_{{ application.id }}"><a class="btn" style="color:#fff; background-color: tomato">0</a></td>
                            <td class="text-center expand-button accordion-toggle collapsed" id="accordion_{{ application.id }}" data-toggle="collapse" data-parent="#accordion_{{ application.id }}" href="#collapse_{{ application.id }}"><a class="btn btn-success">0</a></td>
                            <tr class="hide-table-padding">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td colspan="5">
                            <div id="collapse_{{ application.id }}" class="collapse in p-1">
{#                              <div class="row">#}
{#                                <div class="col-2">label</div>#}
{#                                <div class="col-6">value 1</div>#}
{#                              </div>#}

                                <div class="row">
                                    <div class=""><input type="text" size="1" style="margin-left: 45px;"></div>
                                </div>
                                <div class="row">
                                    <div class="" style="margin-top: 5px;"><a class="btn btn-warning" style="margin-left: 10px;">Сохранить</a></div>
                                </div>

                            </div></td>
                            </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>


          {% endblock content %}

      </div>
    </main>

{% endblock main %}
{% block javascript %}
    <script>
    // AJAX CONFIRM POST
    $('#confirmApplication').click(function(){
        const url = window.location.pathname

        $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify({
                "application": localStorage.getItem('currentRowId'),
                "contest": localStorage.getItem('contestId'),
                "confirmed": true
            }),
            headers: { "X-CSRFToken": "{{ csrf_token }}" },
            success: function(data) {
                location.reload()
                alert('success')
            }
        })
    })

    // AJAX REJECT POST
        $('#rejectApplication').click(function(){
        const url = window.location.pathname

        $.ajax({
            type: "POST",
            url: url,
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify({
                "application": localStorage.getItem('currentRowId'),
                "contest": localStorage.getItem('contestId'),
                "confirmed": false,
                "message": $('textarea#reject_reason').val()
            }),
            headers: { "X-CSRFToken": "{{ csrf_token }}" },
            success: function(data) {
                location.reload()
                alert('reject')
            }
        })
    })
  </script>
{% endblock javascript %}

{#{% block sidebar %}#}
{#{% endblock %}#}
